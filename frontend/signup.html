<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sign Up — OPTIBOTS</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
</head>
<body>

<div class="auth-bg">
  <div class="blob blob-1" style="opacity:0.12;"></div>
  <div class="blob blob-2" style="opacity:0.10;"></div>

  <div class="auth-card">
    <div class="auth-logo">
      <a href="index.html"><span>OPTIBOTS</span></a>
    </div>

    <h2>Create Account</h2>
    <p class="lead">Join the platform as admin or vendor</p>

    <div id="signup-error" class="error-msg"></div>

    <div class="form-group">
      <label for="su-email"><i class="fas fa-envelope" style="margin-right:.4rem;"></i>Email</label>
      <input id="su-email" class="auth-input" type="email" placeholder="you@company.com" autocomplete="email" />
    </div>

    <div class="form-group">
      <label for="su-password"><i class="fas fa-lock" style="margin-right:.4rem;"></i>Password</label>
      <input id="su-password" class="auth-input" type="password" placeholder="Create a strong password" />
    </div>

    <div class="form-group">
      <label for="su-password-confirm"><i class="fas fa-lock" style="margin-right:.4rem;"></i>Confirm Password</label>
      <input id="su-password-confirm" class="auth-input" type="password" placeholder="Repeat your password" />
    </div>

    <div class="form-group">
      <label><i class="fas fa-user-tag" style="margin-right:.4rem;"></i>I am a…</label>
      <div class="role-toggle">
        <input type="radio" id="role-applicant" name="role" value="applicant" checked />
        <label for="role-applicant"><i class="fas fa-building" style="margin-right:.4rem;"></i>Vendor / Applicant</label>
        <input type="radio" id="role-admin" name="role" value="admin" />
        <label for="role-admin"><i class="fas fa-crown" style="margin-right:.4rem;"></i>Admin / Buyer</label>
      </div>
    </div>

    <button class="auth-btn primary" id="signup-btn" onclick="doSignup()">
      <i class="fas fa-user-plus"></i> Create Account
    </button>

    <p class="auth-switch">
      Already have an account? <a href="./login.html">Sign in</a>
    </p>
  </div>
</div>

<div id="toast-container"></div>

<script src="./js/api.js"></script>
<script>

async function doSignup() {
  const email    = document.getElementById('su-email').value.trim();
  const password = document.getElementById('su-password').value;
  const confirm  = document.getElementById('su-password-confirm').value;
  const roleEl   = document.querySelector('input[name="role"]:checked');
  const role     = roleEl ? roleEl.value : 'applicant';
  const errEl    = document.getElementById('signup-error');
  const btn      = document.getElementById('signup-btn');

  errEl.classList.remove('show');

  if (!email || !password) {
    errEl.textContent = 'Email and password are required.';
    errEl.classList.add('show');
    return;
  }
  if (password !== confirm) {
    errEl.textContent = 'Passwords do not match.';
    errEl.classList.add('show');
    return;
  }
  if (password.length < 6) {
    errEl.textContent = 'Password must be at least 6 characters.';
    errEl.classList.add('show');
    return;
  }

  btn.disabled = true;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating account…';

  try {
    await api.post('/auth/register', { email, password, role });
    showToast('Account created! Redirecting to login…', 'success');
    setTimeout(() => { window.location.href = '/login.html'; }, 1500);
  } catch (e) {
    errEl.textContent = 'Signup failed. Email may already be registered.';
    errEl.classList.add('show');
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-user-plus"></i> Create Account';
  }
}

document.addEventListener('keydown', e => { if (e.key === 'Enter') doSignup(); });

function showToast(msg, type='info') {
  const icons = { success:'fa-check-circle', error:'fa-times-circle', info:'fa-info-circle' };
  const t = document.createElement('div');
  t.className = `toast ${type}`;
  t.innerHTML = `<i class="fas ${icons[type]}"></i><span>${msg}</span>`;
  document.getElementById('toast-container').appendChild(t);
  setTimeout(() => t.remove(), 3500);
}
</script>

</body>
</html>
